---
name: declutter
description: Scan workspace for bloat, show what's worth cleaning, ask before fixing. Use when workspaces are slow, Claude freezes, or periodic cleanup.
---

# Declutter

Finds bloated projects, shows the damage, asks before fixing.

## Usage

```
@declutter                    # Scan current workspace
@declutter /path/to/workspace # Scan specific workspace
@declutter --auto             # Fix all without asking
```

## Workflow

### Step 1: Scan Workspace

List top-level directories and check each for bloat:

```bash
# Get workspace path (current directory or provided)
workspace=$(pwd)

# For each project directory, check size and bloat
for dir in */; do
  du -sh "$dir"
done
```

### Step 2: Detect Project Type

Check for marker files to determine project type:

| Marker | Type | Patterns to Ignore |
|--------|------|-------------------|
| requirements.txt, pyproject.toml | Python | .venv/, venv/, __pycache__/, *.pyc |
| package.json | Node | node_modules/, .next/, dist/, .turbo/ |
| Package.swift, *.xcodeproj | Swift | .build/, DerivedData/, *.xcarchive, .swiftpm/ |
| Cargo.toml | Rust | target/ |
| go.mod | Go | vendor/ |

Also detect common bloat: *.log, *.db, *.db-wal, *.parquet, htmlcov/

### Step 3: Find Bloat Directories

Check for known bloat in each project:

```bash
# Check each bloat type
du -sh .venv node_modules __pycache__ .build target logs 2>/dev/null
```

### Step 4: Calculate Token Waste

```bash
# Get bloat size in bytes
bloat_bytes=$(du -sb .venv node_modules __pycache__ 2>/dev/null | awk '{sum+=$1} END {print sum}')

# Estimate tokens (1 byte ≈ 0.25 tokens for text)
tokens_wasted=$((bloat_bytes / 4))
```

### Step 5: Build Report

Present findings as a table:

| Project | Type | Bloat | Tokens Wasted | Status |
|---------|------|-------|---------------|--------|
| my-app | node | 500MB | ~125M | ✗ needs .claudeignore |
| api | python | 200MB | ~50M | ✓ has .claudeignore |

### Step 6: Ask for Approval

> **Projects needing .claudeignore:**
> 1. my-app (500MB bloat)
> 2. old-project (300MB bloat)
>
> **Options:**
> - Fix all
> - Fix specific (list numbers)
> - Skip

### Step 7: Create .claudeignore

For each approved project, create `.claudeignore` based on detected type:

**Python project:**
```
# Auto-generated by @declutter
.venv/
venv/
__pycache__/
*.pyc
```

**Node project:**
```
# Auto-generated by @declutter
node_modules/
.next/
dist/
```

**Swift project:**
```
# Auto-generated by @declutter
.build/
DerivedData/
*.xcarchive
```

**Mixed project (multiple types):**
Combine patterns from all detected types.

**Common patterns (always add if detected):**
```
*.log
logs/
*.db
*.db-wal
*.db-shm
htmlcov/
.coverage
```

### Step 8: Report Results

```
✓ my-app/.claudeignore created (8 patterns)
✓ old-project/.claudeignore created (5 patterns)

Total savings: ~175M tokens
Restart Claude for changes to take effect.
```

## Example Session

**User:** @declutter

**Claude:** Scanning workspace...

```
| Project | Type | Bloat | Status |
|---------|------|-------|--------|
| webapp | node | 1.2GB | ✗ needs fix |
| api | python | 400MB | ✓ exists |
| scripts | python | 50MB | ✗ needs fix |

2 projects need .claudeignore. Fix them?
```

**User:** yes

**Claude:**
```
✓ webapp/.claudeignore created
✓ scripts/.claudeignore created

Restart Claude to apply.
```

## Why This Matters

Claude Code indexes your workspace to understand context. When it tries to index:
- 938MB log files
- 1GB node_modules
- 500MB Python venvs

...it freezes or runs out of context.

`.claudeignore` tells Claude to skip these directories, just like `.gitignore` tells git to skip files.

**Token math:**
```
5GB bloat ÷ 4 bytes/token ≈ 1.25 billion tokens wasted
```

That's context that could be used for actual code understanding.
